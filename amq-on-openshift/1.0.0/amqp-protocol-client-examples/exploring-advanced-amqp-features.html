<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Exploring Advanced AMQP Features :: AMQ Broker on OpenShift: Deployment and Management</title>
    <link rel="prev" href="connecting-to-amq-broker-using-amqp.html">
    <link rel="next" href="../hands-on-lab-deploying-and-managing-amq-broker/hands-on-lab-deploying-and-managing-amq-broker.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">AMQ Broker on OpenShift: Deployment and Management</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-on-openshift" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../overview-of-message-oriented-middleware/overview-of-message-oriented-middleware.html">Overview of Message-Oriented Middleware</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/introduction-to-message-oriented-middleware-mom.html">Introduction to Message-Oriented Middleware (MOM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/benefits-and-use-cases-of-asynchronous-messaging.html">Benefits and Use Cases of Asynchronous Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/core-concepts-producers-consumers-queues-topics.html">Core Concepts: Producers, Consumers, Queues, Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/common-messaging-patterns-point-to-point-publishsubscribe.html">Common Messaging Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-overview/amq-broker-overview.html">AMQ Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/introduction-to-red-hat-amq-broker.html">Introduction to Red Hat AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/foundations-in-apache-activemq-artemis.html">Foundations in Apache ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/key-features-and-capabilities.html">Key Features and Capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/supported-messaging-protocols-jms-amqp-mqtt-stomp-openwire.html">Supported Messaging Protocols (JMS, AMQP, MQTT, STOMP, OpenWire)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/amq-broker-architecture.html">AMQ Broker Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/deploying-amq-broker-on-openshift.html">Deploying AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/openshift-container-platform-fundamentals-for-amq-broker.html">OpenShift Container Platform Fundamentals for AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/introduction-to-the-amq-broker-operator.html">Introduction to the AMQ Broker Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/installing-the-amq-broker-operator-via-cli-or-operatorhub.html">Installing the AMQ Broker Operator via CLI or OperatorHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/understanding-amq-broker-custom-resource-definitions-crds.html">understanding-amq-broker-custom-resource-definitions-crds.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/creating-and-managing-broker-instances-with-custom-resources-crs.html">Creating and Managing Broker Instances with Custom Resources (CRs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/monitoring-initial-broker-deployment.html">Monitoring Initial Broker Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-amq-broker-on-openshift.html">Scaling AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/concepts-of-horizontal-and-vertical-scaling.html">Concepts of Horizontal and Vertical Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-broker-pods-and-replicas.html">Scaling Broker Pods and Replicas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/adjusting-resource-allocations-cpu-memory-for-broker-pods.html">Adjusting Resource Allocations (CPU, Memory) for Broker Pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/performance-considerations-for-scaling.html">Performance Considerations for Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/best-practices-for-scaling-in-openshift.html">Best Practices for Scaling AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../securing-amq-broker-on-openshift/securing-amq-broker-on-openshift.html">Securing AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/encrypting-connections.html">Encrypting Connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-ssltls-for-client-broker-communication.html">Configuring SSL/TLS for Client-Broker Communication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/managing-certificates-and-trust-stores-on-openshift.html">Managing Certificates and Trust Stores on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-secure-listeners.html">Enabling Secure Listeners</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-rbac-role-based-access-control.html">Enabling RBAC (Role-Based Access Control)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/defining-users-roles-and-permissions-in-amq-broker.html">Defining Users, Roles, and Permissions in AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-with-openshift-authentication-mechanisms.html">Integrating with OpenShift Authentication Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-external-identity-providers-idp.html">Integrating External Identity Providers (IDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/overview-of-external-idp-integration-eg-ldap-keycloak.html">Overview of External IDP Integration (e.g., LDAP, Keycloak)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-amq-broker-for-external-idp-authentication.html">Configuring AMQ Broker for External Identity Provider (IDP) Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/mapping-external-roles-to-broker-roles.html">Mapping External Roles to Broker Roles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/amq-broker-high-availability-on-openshift.html">AMQ Broker High Availability on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/introduction-to-high-availability-ha-concepts.html">Introduction to High Availability (HA) Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/broker-clustering-strategies-shared-store-vs-replicated-live-backup.html">Broker Clustering Strategies: Shared Store vs. Replicated Live-Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/deploying-and-configuring-an-ha-broker-pair.html">Deploying and Configuring an HA Broker Pair</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/understanding-failover-and-recovery-mechanisms.html">Understanding Failover and Recovery Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/persistence-and-data-replication-for-ha.html">Persistence and Data Replication for HA</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/different-message-stores-for-amq-broker-on-openshift.html">Different Message Stores for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/overview-of-message-store-options.html">Overview of Message Store Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/file-based-message-store-configuration.html">File-Based Message Store Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/jdbc-message-store-integration-with-external-databases.html">JDBC Message Store Integration with External Databases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/journal-vs-paging-for-message-persistence.html">Journal vs. Paging for Message Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/choosing-the-appropriate-message-store-strategy.html">Choosing the Appropriate Message Store Strategy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/openshift-storage-considerations-persistent-volumes.html">Storage Considerations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/accessing-management-console-for-amq-broker-on-openshift.html">Accessing Management Console for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/introduction-to-the-hawtio-management-console.html">Introduction to the Hawtio Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/exposing-the-console-via-openshift-routes.html">Exposing the Hawtio Management Console via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/authentication-and-authorization-for-console-access.html">Authentication and Authorization for AMQ Broker Management Console Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/monitoring-broker-metrics-queues-and-topics.html">Monitoring Broker Metrics, Queues, and Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/performing-administrative-tasks-through-the-console.html">Performing Administrative Tasks through the Console</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/enabling-external-access-to-brokers-deployed-on-openshift.html">Enabling External Access to Brokers Deployed on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/openshift-networking-concepts-services-routes-ingress.html">OpenShift Networking Concepts: Services, Routes, Ingress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/exposing-broker-listeners-via-openshift-routes.html">Exposing Broker Listeners via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/configuring-client-connections-for-external-access.html">Configuring Client Connections for External Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/security-implications-and-best-practices-for-external-access.html">Securing External Access to AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core-protocol-client-examples/core-protocol-client-examples.html">Core Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/introduction-to-amq-core-protocol.html">Introduction to AMQ Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/setting-up-a-core-protocol-client-development-environment.html">Setting Up a Core Protocol Client Development Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/developing-producers-and-consumers-with-java-core-protocol.html">Developing Producers and Consumers with Java Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-point-to-point-messaging.html">Implementing Point-to-Point Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-publishsubscribe-messaging.html">Implementing Publish/Subscribe Messaging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="amqp-protocol-client-examples.html">AMQP Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="introduction-to-amqp-10-standard.html">Introduction to AMQP 1.0 Standard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="setting-up-an-amqp-client-development-environment-eg-qpid-jms.html">Setting Up an AMQP Client Development Environment (e.g., Qpid JMS)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="developing-producers-and-consumers-with-amqp-clients-eg-java-python.html">Developing Producers and Consumers with AMQP Clients (e.g., Java, Python)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="connecting-to-amq-broker-using-amqp.html">Connecting to AMQ Broker using AMQP</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="exploring-advanced-amqp-features.html">Exploring Advanced AMQP Features</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/hands-on-lab-deploying-and-managing-amq-broker.html">Hands-on Lab: Deploying and Managing AMQ Broker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-deploying-a-basic-amq-broker-instance.html">Lab: Deploying a Basic AMQ Broker Instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-configuring-external-access-and-testing-client-connectivity.html">Lab: Configuring External Access and Testing Client Connectivity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-implementing-basic-security-encryption-rbac.html">Lab: Implementing Basic Security (Encryption, RBAC)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-deploying-an-ha-broker-cluster.html">Lab: Deploying an HA Broker Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-monitoring-with-the-management-console.html">Lab: Monitoring with the Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-developing-and-testing-core-protocol-and-amqp-clients.html">Lab: Developing and Testing Core Protocol and AMQP Clients</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">AMQ Broker on OpenShift: Deployment and Management</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></li>
    <li><a href="amqp-protocol-client-examples.html">AMQP Protocol Client Examples</a></li>
    <li><a href="exploring-advanced-amqp-features.html">Exploring Advanced AMQP Features</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Exploring Advanced AMQP Features</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section delves into advanced capabilities of the AMQP 1.0 protocol, allowing you to build more robust, reliable, and sophisticated messaging applications with Red Hat AMQ Broker. While basic message production and consumption form the foundation, understanding these advanced features is crucial for tackling real-world enterprise integration patterns. We will explore how these features enhance message delivery guarantees, provide greater flexibility, and enable more complex messaging workflows.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_amqp_1_0_flow_control_credits"><a class="anchor" href="#_understanding_amqp_1_0_flow_control_credits"></a>Understanding AMQP 1.0 Flow Control (Credits)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AMQP 1.0 uses a credit-based flow control mechanism to regulate the rate at which messages are transferred between a sender and a receiver. Unlike some other protocols that rely on TCP windowing or simple buffer limits, AMQP 1.0 provides explicit control over message flow at the application level.</p>
</div>
<div class="paragraph">
<p>When a receiver (consumer) is ready to accept messages, it issues <strong>credits</strong> to the sender (producer). Each credit represents permission for the sender to transmit one message. The sender can only send messages as long as it has credits. Once the sender&#8217;s credit count reaches zero, it must stop sending until the receiver issues more credits.</p>
</div>
<div class="paragraph">
<p>This mechanism ensures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Consumer Overload Prevention</strong>: Consumers can control their incoming message rate, preventing them from being overwhelmed by a fast producer. This is especially critical for consumers with limited processing capacity or downstream systems that cannot handle high throughput bursts.</p>
</li>
<li>
<p><strong>Efficient Resource Utilization</strong>: By precisely controlling the flow, unnecessary buffering and potential resource exhaustion on either the sender or receiver side can be avoided.</p>
</li>
<li>
<p><strong>Fairness</strong>: In complex scenarios with multiple producers and consumers, flow control helps distribute messages equitably and prevents "starvation" of certain consumers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In most client libraries (like Qpid JMS), flow control is handled automatically. However, understanding its underlying mechanism is vital for troubleshooting performance issues or designing high-performance applications. For instance, a consumer might intentionally reduce its credit issuance if it&#8217;s experiencing back pressure from its own processing logic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-amqp-transactions"><a class="anchor" href="#implementing-amqp-transactions"></a>Implementing AMQP Transactions for Reliable Messaging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transactional messaging is a cornerstone of reliable enterprise applications. AMQP 1.0 supports transactions, allowing a client to group multiple message production and consumption operations into a single, atomic unit of work. This ensures an "all-or-nothing" outcome: either all operations within the transaction succeed and are committed, or none of them do, and the transaction is rolled back.</p>
</div>
<div class="paragraph">
<p>The primary benefits of using AMQP transactions are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Atomicity</strong>: Guarantees that related message operations (e.g., sending a message and acknowledging a received message) are treated as a single indivisible unit. If one part fails, the entire transaction is undone.</p>
</li>
<li>
<p><strong>Data Consistency</strong>: Prevents data inconsistencies that could arise from partial message processing or delivery failures.</p>
</li>
<li>
<p><strong>Idempotence</strong>: Can help in designing idempotent message handlers by ensuring that messages are only processed once successfully within a transaction.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An AMQP transaction involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Begin Transaction</strong>: The client signals the broker to start a new transaction context.</p>
</li>
<li>
<p><strong>Perform Operations</strong>: Messages are sent to the broker, or messages are received and acknowledged from the broker, all within the context of the current transaction. These operations are not visible to other clients until the transaction is committed.</p>
</li>
<li>
<p><strong>Commit Transaction</strong>: If all operations are successful, the client signals the broker to commit the transaction. All changes become permanent and visible.</p>
</li>
<li>
<p><strong>Rollback Transaction</strong>: If an error occurs, the client signals the broker to roll back the transaction. All changes made within the transaction are discarded, and messages that were part of the transaction (e.g., messages sent but not committed, or messages received but not acknowledged) are returned to their queues.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_hands_on_lab_implementing_amqp_transactions"><a class="anchor" href="#_hands_on_lab_implementing_amqp_transactions"></a>Hands-on Lab: Implementing AMQP Transactions</h3>
<div class="paragraph">
<p>In this lab, you will implement a simple AMQP producer and consumer that use transactions to ensure reliable message handling. The producer will send a batch of messages transactionally, and the consumer will receive and process them, acknowledging them within its own transaction.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>An AMQ Broker instance deployed and accessible (as covered in previous labs, e.g., "Deploying a Basic AMQ Broker Instance").</p>
</li>
<li>
<p>A Java development environment with Maven configured.</p>
</li>
<li>
<p>The Qpid JMS client library added to your project&#8217;s <code>pom.xml</code>. If you don&#8217;t have this, ensure your <code>pom.xml</code> includes:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.qpid&lt;/groupId&gt;
        &lt;artifactId&gt;qpid-jms-client&lt;/artifactId&gt;
        &lt;version&gt;2.5.0.redhat-00002&lt;/version&gt;  // Use the version compatible with your broker, context mentions 2.7
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_transactional_amqp_producer"><a class="anchor" href="#_step_1_create_a_transactional_amqp_producer"></a>Step 1: Create a Transactional AMQP Producer</h4>
<div class="paragraph">
<p>Create a Java class named <code>TransactionalProducer.java</code>. This producer will send three messages in a single transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

public class TransactionalProducer {

    public static void main(String[] args) throws JMSException {
        // Connection details for your AMQ Broker
        String brokerUrl = "amqp://localhost:5672"; // Adjust if your broker is not on localhost:5672
        String queueName = "transactionalQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            // Create a transacted session
            session = connection.createSession(true, Session.SESSION_TRANSACTED); // true for transacted
            Destination destination = session.createQueue(queueName);
            MessageProducer producer = session.createProducer(destination);

            System.out.println("Starting transaction...");

            // Send messages within the transaction
            for (int i = 0; i &lt; 3; i++) {
                String messageText = "Transactional Message " + (i + 1);
                TextMessage message = session.createTextMessage(messageText);
                producer.send(message);
                System.out.println("Sent: " + messageText);
            }

            // Simulate an error condition (uncomment to test rollback)
            // if (true) {
            //     throw new RuntimeException("Simulating an error before commit!");
            // }

            // Commit the transaction
            session.commit();
            System.out.println("Transaction committed successfully. Messages are now visible.");

        } catch (Exception e) {
            System.err.println("Error during transaction: " + e.getMessage());
            if (session != null) {
                session.rollback(); // Rollback on error
                System.out.println("Transaction rolled back. Messages were not sent.");
            }
        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_create_a_transactional_amqp_consumer"><a class="anchor" href="#_step_2_create_a_transactional_amqp_consumer"></a>Step 2: Create a Transactional AMQP Consumer</h4>
<div class="paragraph">
<p>Create a Java class named <code>TransactionalConsumer.java</code>. This consumer will receive messages and acknowledge them within its own transaction.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

public class TransactionalConsumer {

    public static void main(String[] args) throws JMSException, InterruptedException {
        String brokerUrl = "amqp://localhost:5672"; // Adjust if your broker is not on localhost:5672
        String queueName = "transactionalQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            // Create a transacted session
            session = connection.createSession(true, Session.SESSION_TRANSACTED); // true for transacted
            Destination destination = session.createQueue(queueName);
            MessageConsumer consumer = session.createConsumer(destination);

            System.out.println("Waiting for messages. Press Ctrl+C to exit.");

            // Consume messages in a loop
            for (int i = 0; i &lt; 3; i++) { // Expecting 3 messages
                Message message = consumer.receive(5000); // Wait up to 5 seconds
                if (message instanceof TextMessage) {
                    TextMessage textMessage = (TextMessage) message;
                    System.out.println("Received: " + textMessage.getText());

                    // Simulate processing failure for the 2nd message (uncomment to test rollback)
                    // if (i == 1) {
                    //     System.out.println("Simulating processing failure for message " + (i+1));
                    //     throw new RuntimeException("Simulated processing error!");
                    // }

                } else if (message == null) {
                    System.out.println("No more messages received within timeout.");
                    break;
                }
            }

            // Commit the transaction after successful processing of all messages
            session.commit();
            System.out.println("Consumer transaction committed. Messages acknowledged.");

        } catch (Exception e) {
            System.err.println("Error during consumer transaction: " + e.getMessage());
            if (session != null) {
                session.rollback(); // Rollback on error
                System.out.println("Consumer transaction rolled back. Messages will be redelivered.");
            }
        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_run_the_lab"><a class="anchor" href="#_step_3_run_the_lab"></a>Step 3: Run the Lab</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Compile both Java files. If using Maven, run <code>mvn clean install</code> in your project directory.</p>
</li>
<li>
<p>Start the <code>TransactionalConsumer</code> first:
<code>java -cp target/your-app-jar-with-dependencies.jar TransactionalConsumer</code></p>
</li>
<li>
<p>In a separate terminal, start the <code>TransactionalProducer</code>:
<code>java -cp target/your-app-jar-with-dependencies.jar TransactionalProducer</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You should observe:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The producer sending messages and committing the transaction.</p>
</li>
<li>
<p>The consumer receiving and processing the messages, then committing its transaction.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_step_4_test_rollback"><a class="anchor" href="#_step_4_test_rollback"></a>Step 4: Test Rollback</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Producer Rollback</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Uncomment the <code>throw new RuntimeException("Simulating an error before commit!");</code> line in <code>TransactionalProducer.java</code>.</p>
</li>
<li>
<p>Run the producer. Observe that it reports a rollback.</p>
</li>
<li>
<p>Run the consumer. It should not receive any messages, as the producer&#8217;s transaction was rolled back.</p>
</li>
<li>
<p>Comment out the error line again.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Consumer Rollback</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Ensure the producer error line is commented out.</p>
</li>
<li>
<p>Uncomment the <code>if (i == 1) { &#8230;&#8203; }</code> block in <code>TransactionalConsumer.java</code>.</p>
</li>
<li>
<p>Run the producer (it will commit its messages).</p>
</li>
<li>
<p>Run the consumer. It should receive the first message, then simulate an error, causing a rollback. The messages will then be redelivered if you run the consumer again, demonstrating that the acknowledgement was undone.</p>
</li>
<li>
<p>Comment out the error line again.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This lab demonstrates how transactions ensure that messages are either fully processed and acknowledged or fully undone and redelivered, maintaining data consistency.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="leveraging-message-properties-and-headers"><a class="anchor" href="#leveraging-message-properties-and-headers"></a>Leveraging Message Properties and Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Beyond the message body, AMQP messages can carry a rich set of metadata through properties and headers. This metadata is crucial for routing, filtering, auditing, and conveying application-specific information without embedding it directly into the message payload.</p>
</div>
<div class="paragraph">
<p>AMQP 1.0 defines several standard header fields (e.g., <code>message-id</code>, <code>correlation-id</code>, <code>reply-to</code>, <code>content-type</code>, <code>delivery-count</code>). In addition to these, you can define <strong>application-specific properties</strong>, which are custom key-value pairs that your application understands.</p>
</div>
<div class="paragraph">
<p>Key uses of message properties and headers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Correlation</strong>: The <code>correlation-id</code> is vital for request/reply patterns, linking a response message back to its original request.</p>
</li>
<li>
<p><strong>Routing and Filtering</strong>: Brokers can use headers to route messages to specific queues or subscribers. Consumers can use message selectors (if supported by the broker and client) to filter messages based on their properties, receiving only those that match specific criteria.</p>
</li>
<li>
<p><strong>Metadata Propagation</strong>: Carry information like the sender&#8217;s identity, timestamp of creation, message priority, or any other application-specific context that aids in processing.</p>
</li>
<li>
<p><strong>Tracing and Auditing</strong>: Properties can include identifiers for tracing a message&#8217;s journey through a system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Properties are typically immutable once a message is sent. Clients interact with them using methods provided by the JMS <code>Message</code> interface (e.g., <code>setStringProperty()</code>, <code>getIntProperty()</code>, <code>getPropertyNames()</code>).</p>
</div>
<div class="sect2">
<h3 id="_hands_on_lab_sending_and_receiving_messages_with_custom_properties"><a class="anchor" href="#_hands_on_lab_sending_and_receiving_messages_with_custom_properties"></a>Hands-on Lab: Sending and Receiving Messages with Custom Properties</h3>
<div class="paragraph">
<p>This lab will demonstrate how to add custom application properties to messages sent by a producer and how a consumer can read these properties.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_2"><a class="anchor" href="#_prerequisites_2"></a>Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>An AMQ Broker instance deployed and accessible.</p>
</li>
<li>
<p>A Java development environment with Maven and Qpid JMS client library.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_producer_with_custom_properties"><a class="anchor" href="#_step_1_create_a_producer_with_custom_properties"></a>Step 1: Create a Producer with Custom Properties</h4>
<div class="paragraph">
<p>Create a Java class named <code>PropertyProducer.java</code>. This producer will send messages with custom properties for <code>category</code> and <code>priority</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

public class PropertyProducer {

    public static void main(String[] args) throws JMSException {
        String brokerUrl = "amqp://localhost:5672";
        String queueName = "propertyQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
            Destination destination = session.createQueue(queueName);
            MessageProducer producer = session.createProducer(destination);

            // Send Message 1 with specific properties
            TextMessage message1 = session.createTextMessage("Report for Q4 Financials");
            message1.setStringProperty("category", "Finance");
            message1.setIntProperty("priority", 1);
            message1.setJMSCorrelationID("FIN-Q4-2023"); // Example standard JMS property
            producer.send(message1);
            System.out.println("Sent Message 1: " + message1.getText() + " with properties.");

            // Send Message 2 with different properties
            TextMessage message2 = session.createTextMessage("User Login Failure Alert");
            message2.setStringProperty("category", "Security");
            message2.setIntProperty("priority", 5);
            producer.send(message2);
            System.out.println("Sent Message 2: " + message2.getText() + " with properties.");

            // Send Message 3 without special properties
            TextMessage message3 = session.createTextMessage("General Info Update");
            producer.send(message3);
            System.out.println("Sent Message 3: " + message3.getText() + " (no custom properties).");

        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_create_a_consumer_that_reads_properties"><a class="anchor" href="#_step_2_create_a_consumer_that_reads_properties"></a>Step 2: Create a Consumer that Reads Properties</h4>
<div class="paragraph">
<p>Create a Java class named <code>PropertyConsumer.java</code>. This consumer will receive messages and extract their custom properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

import java.util.Enumeration;

public class PropertyConsumer {

    public static void main(String[] args) throws JMSException, InterruptedException {
        String brokerUrl = "amqp://localhost:5672";
        String queueName = "propertyQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
            Destination destination = session.createQueue(queueName);
            MessageConsumer consumer = session.createConsumer(destination);

            System.out.println("Waiting for messages with properties. Press Ctrl+C to exit.");

            int receivedCount = 0;
            while (receivedCount &lt; 3) { // Expecting 3 messages
                Message message = consumer.receive(5000); // Wait up to 5 seconds
                if (message instanceof TextMessage) {
                    TextMessage textMessage = (TextMessage) message;
                    System.out.println("\nReceived: " + textMessage.getText());

                    // Read custom properties
                    String category = textMessage.getStringProperty("category");
                    int priority = textMessage.getIntProperty("priority"); // Defaults to 0 if not set

                    if (category != null) {
                        System.out.println("  Custom Property - Category: " + category);
                    }
                    if (priority != 0) { // Check if it was explicitly set to a non-zero value
                        System.out.println("  Custom Property - Priority: " + priority);
                    }

                    // Read a standard JMS property
                    String correlationId = textMessage.getJMSCorrelationID();
                    if (correlationId != null) {
                        System.out.println("  JMS Correlation ID: " + correlationId);
                    }

                    // Iterate over all properties (useful for debugging)
                    System.out.println("  All Properties:");
                    Enumeration&lt;String&gt; propertyNames = message.getPropertyNames();
                    while (propertyNames.hasMoreElements()) {
                        String propName = propertyNames.nextElement();
                        System.out.println("    - " + propName + ": " + message.getObjectProperty(propName));
                    }
                    receivedCount++;

                } else if (message == null) {
                    System.out.println("No more messages received within timeout.");
                    break;
                }
            }

        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_run_the_lab_2"><a class="anchor" href="#_step_3_run_the_lab_2"></a>Step 3: Run the Lab</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Compile both Java files (e.g., <code>mvn clean install</code>).</p>
</li>
<li>
<p>Start the <code>PropertyConsumer</code> first:
<code>java -cp target/your-app-jar-with-dependencies.jar PropertyConsumer</code></p>
</li>
<li>
<p>In a separate terminal, start the <code>PropertyProducer</code>:
<code>java -cp target/your-app-jar-with-dependencies.jar PropertyProducer</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Observe the output from the consumer. You should see the custom <code>category</code> and <code>priority</code> properties, along with the standard <code>JMSCorrelationID</code> for the first message, demonstrating how metadata can be transmitted alongside the message payload.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fine-grained-message-acknowledgement"><a class="anchor" href="#fine-grained-message-acknowledgement"></a>Fine-Grained Message Acknowledgement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Message acknowledgement (ACK) is a critical mechanism for guaranteeing message delivery and preventing data loss. It signals to the broker that a consumer has successfully received and processed a message, allowing the broker to remove the message from its store. AMQP 1.0, often through its JMS mapping, offers different acknowledgement modes, giving applications fine-grained control over when and how messages are acknowledged.</p>
</div>
<div class="paragraph">
<p>The common acknowledgement modes provided by JMS clients like Qpid JMS are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AUTO_ACKNOWLEDGE (default for non-transacted sessions)</strong>: The session automatically acknowledges a message when it has successfully returned from a <code>receive()</code> call or when the <code>onMessage()</code> method of a <code>MessageListener</code> has completed. This is the simplest mode but offers the least control. Messages might be lost if processing fails <strong>after</strong> auto-acknowledgement but <strong>before</strong> the message is fully handled by the application.</p>
</li>
<li>
<p><strong>CLIENT_ACKNOWLEDGE</strong>: The client application is responsible for explicitly acknowledging messages using the <code>message.acknowledge()</code> method. This gives the application full control over when a message is considered processed. If processing fails, the application can choose not to acknowledge, and the message will eventually be redelivered.</p>
</li>
<li>
<p><strong>DUPS_OK_ACKNOWLEDGE</strong>: This mode is lazier than <code>CLIENT_ACKNOWLEDGE</code>. It instructs the session to acknowledge the delivery of messages only when a moderate batch of messages has been received. This can improve performance but may result in duplicate messages being delivered if the client fails between a batch acknowledgement and subsequent message processing.</p>
</li>
<li>
<p><strong>SESSION_TRANSACTED</strong>: As seen in the previous lab, in a transacted session, acknowledgements are implicitly handled as part of the transaction commit. Messages are acknowledged only when the transaction is successfully committed. If the transaction is rolled back, any received messages that were part of the transaction are not acknowledged and may be redelivered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For reliable messaging where "at-least-once" delivery is required and potential message redelivery must be handled, <code>CLIENT_ACKNOWLEDGE</code> or <code>SESSION_TRANSACTED</code> are generally preferred. <code>CLIENT_ACKNOWLEDGE</code> provides explicit control for non-transactional contexts.</p>
</div>
<div class="sect2">
<h3 id="hands-on-lab-client-controlled-acknowledgement"><a class="anchor" href="#hands-on-lab-client-controlled-acknowledgement"></a>Hands-on Lab: Implementing Client-Controlled Acknowledgement</h3>
<div class="paragraph">
<p>In this lab, you will implement a consumer that uses <code>CLIENT_ACKNOWLEDGE</code> mode. This allows you to explicitly decide when to acknowledge a message, and observe what happens if a message is not acknowledged due to a simulated processing error.</p>
</div>
<div class="sect3">
<h4 id="_prerequisites_3"><a class="anchor" href="#_prerequisites_3"></a>Prerequisites</h4>
<div class="ulist">
<ul>
<li>
<p>An AMQ Broker instance deployed and accessible.</p>
</li>
<li>
<p>A Java development environment with Maven and Qpid JMS client library.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_step_1_create_a_producer"><a class="anchor" href="#_step_1_create_a_producer"></a>Step 1: Create a Producer</h4>
<div class="paragraph">
<p>Use a simple producer (similar to the basic examples or <code>PropertyProducer</code> without properties). This producer will just send a few messages to a queue. For simplicity, we&#8217;ll quickly create one:</p>
</div>
<div class="paragraph">
<p>Create a Java class named <code>SimpleProducer.java</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

public class SimpleProducer {

    public static void main(String[] args) throws JMSException {
        String brokerUrl = "amqp://localhost:5672";
        String queueName = "clientAckQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
            Destination destination = session.createQueue(queueName);
            MessageProducer producer = session.createProducer(destination);

            for (int i = 0; i &lt; 3; i++) {
                TextMessage message = session.createTextMessage("Message " + (i + 1));
                producer.send(message);
                System.out.println("Sent: " + message.getText());
            }

        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_2_create_a_client_acknowledging_consumer"><a class="anchor" href="#_step_2_create_a_client_acknowledging_consumer"></a>Step 2: Create a Client-Acknowledging Consumer</h4>
<div class="paragraph">
<p>Create a Java class named <code>ClientAckConsumer.java</code>. This consumer will process messages but will explicitly acknowledge them only after successful processing. We will simulate a failure for one message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.jms.*;
import org.apache.qpid.jms.JmsConnectionFactory;

public class ClientAckConsumer {

    public static void main(String[] args) throws JMSException, InterruptedException {
        String brokerUrl = "amqp://localhost:5672";
        String queueName = "clientAckQueue";

        Connection connection = null;
        Session session = null;

        try {
            JmsConnectionFactory factory = new JmsConnectionFactory(brokerUrl);
            connection = factory.createConnection();
            connection.start();

            // Create a session with CLIENT_ACKNOWLEDGE mode
            session = connection.createSession(false, Session.CLIENT_ACKNOWLEDGE);
            Destination destination = session.createQueue(queueName);
            MessageConsumer consumer = session.createConsumer(destination);

            System.out.println("Waiting for messages with CLIENT_ACKNOWLEDGE. Press Ctrl+C to exit.");

            int receivedCount = 0;
            while (receivedCount &lt; 3) { // Try to receive 3 messages
                Message message = consumer.receive(10000); // Wait up to 10 seconds

                if (message instanceof TextMessage) {
                    TextMessage textMessage = (TextMessage) message;
                    String msgText = textMessage.getText();
                    System.out.println("Received: " + msgText + " (Delivery Count: " + textMessage.getJMSDeliveryMode() + ")"); // JMSDeliveryMode is often DeliveryCount in AMQP 1.0 context

                    // Simulate a processing error for "Message 2"
                    if (msgText.contains("Message 2") &amp;&amp; textMessage.getJMSRedelivered() == false) { // Only fail on first delivery
                        System.err.println("  Simulating processing failure for: " + msgText + ". NOT ACKNOWLEDGING.");
                        // DO NOT acknowledge the message. It will be redelivered later.
                        receivedCount++; // Still count it as received for this attempt
                        continue; // Skip acknowledgement
                    }

                    // Acknowledge the message only if processing was successful
                    message.acknowledge();
                    System.out.println("  Acknowledged: " + msgText);
                    receivedCount++;

                } else if (message == null) {
                    System.out.println("No more messages received within timeout.");
                    break;
                }
            }

        } catch (Exception e) {
            System.err.println("An error occurred: " + e.getMessage());
        } finally {
            if (session != null) {
                session.close();
            }
            if (connection != null) {
                connection.close();
            }
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_step_3_run_the_lab_3"><a class="anchor" href="#_step_3_run_the_lab_3"></a>Step 3: Run the Lab</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Compile both Java files (e.g., <code>mvn clean install</code>).</p>
</li>
<li>
<p>Start the <code>SimpleProducer</code>:
<code>java -cp target/your-app-jar-with-dependencies.jar SimpleProducer</code>
(It will send 3 messages and exit.)</p>
</li>
<li>
<p>Start the <code>ClientAckConsumer</code>:
<code>java -cp target/your-app-jar-with-dependencies.jar ClientAckConsumer</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Observe the output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The consumer will receive "Message 1" and acknowledge it.</p>
</li>
<li>
<p>It will then receive "Message 2", simulate a failure, and <strong>not</strong> acknowledge it.</p>
</li>
<li>
<p>It will receive "Message 3" and acknowledge it.</p>
</li>
<li>
<p>The consumer might then exit (if <code>receivedCount</code> reaches 3) or wait for more messages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, wait for a few moments (the broker will redeliver unacknowledged messages after a timeout).
Run the <code>ClientAckConsumer</code> <strong>again</strong>:
<code>java -cp target/your-app-jar-with-dependencies.jar ClientAckConsumer</code></p>
</div>
<div class="paragraph">
<p>This time, the consumer should eventually receive "Message 2" <strong>again</strong>. Notice the <code>JMSRedelivered</code> flag on the message or an increased delivery count (depending on client library specifics, Qpid JMS often maps AMQP&#8217;s <code>delivery-count</code> to <code>JMSXDeliveryCount</code> or similar extended property, but the <code>JMSRedelivered</code> flag is standard). This demonstrates that messages are kept by the broker until explicitly acknowledged, ensuring "at-least-once" delivery semantics.</p>
</div>
<div class="paragraph">
<p>This explicit control is crucial for applications where messages drive business processes, and partial processing is unacceptable.</p>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="connecting-to-amq-broker-using-amqp.html">Connecting to AMQ Broker using AMQP</a></span>
  <span class="next"><a href="../hands-on-lab-deploying-and-managing-amq-broker/hands-on-lab-deploying-and-managing-amq-broker.html">Hands-on Lab: Deploying and Managing AMQ Broker</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
