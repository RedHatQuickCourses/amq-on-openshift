<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Deploying an HA Broker Cluster :: AMQ Broker on OpenShift: Deployment and Management</title>
    <link rel="prev" href="lab-implementing-basic-security-encryption-rbac.html">
    <link rel="next" href="lab-monitoring-with-the-management-console.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">AMQ Broker on OpenShift: Deployment and Management</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-on-openshift" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../overview-of-message-oriented-middleware/overview-of-message-oriented-middleware.html">Overview of Message-Oriented Middleware</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/introduction-to-message-oriented-middleware-mom.html">Introduction to Message-Oriented Middleware (MOM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/benefits-and-use-cases-of-asynchronous-messaging.html">Benefits and Use Cases of Asynchronous Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/core-concepts-producers-consumers-queues-topics.html">Core Concepts: Producers, Consumers, Queues, Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/common-messaging-patterns-point-to-point-publishsubscribe.html">Common Messaging Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-overview/amq-broker-overview.html">AMQ Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/introduction-to-red-hat-amq-broker.html">Introduction to Red Hat AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/foundations-in-apache-activemq-artemis.html">Foundations in Apache ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/key-features-and-capabilities.html">Key Features and Capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/supported-messaging-protocols-jms-amqp-mqtt-stomp-openwire.html">Supported Messaging Protocols (JMS, AMQP, MQTT, STOMP, OpenWire)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/amq-broker-architecture.html">AMQ Broker Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/deploying-amq-broker-on-openshift.html">Deploying AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/openshift-container-platform-fundamentals-for-amq-broker.html">OpenShift Container Platform Fundamentals for AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/introduction-to-the-amq-broker-operator.html">Introduction to the AMQ Broker Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/installing-the-amq-broker-operator-via-cli-or-operatorhub.html">Installing the AMQ Broker Operator via CLI or OperatorHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/understanding-amq-broker-custom-resource-definitions-crds.html">understanding-amq-broker-custom-resource-definitions-crds.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/creating-and-managing-broker-instances-with-custom-resources-crs.html">Creating and Managing Broker Instances with Custom Resources (CRs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/monitoring-initial-broker-deployment.html">Monitoring Initial Broker Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-amq-broker-on-openshift.html">Scaling AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/concepts-of-horizontal-and-vertical-scaling.html">Concepts of Horizontal and Vertical Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-broker-pods-and-replicas.html">Scaling Broker Pods and Replicas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/adjusting-resource-allocations-cpu-memory-for-broker-pods.html">Adjusting Resource Allocations (CPU, Memory) for Broker Pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/performance-considerations-for-scaling.html">Performance Considerations for Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/best-practices-for-scaling-in-openshift.html">Best Practices for Scaling AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../securing-amq-broker-on-openshift/securing-amq-broker-on-openshift.html">Securing AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/encrypting-connections.html">Encrypting Connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-ssltls-for-client-broker-communication.html">Configuring SSL/TLS for Client-Broker Communication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/managing-certificates-and-trust-stores-on-openshift.html">Managing Certificates and Trust Stores on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-secure-listeners.html">Enabling Secure Listeners</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-rbac-role-based-access-control.html">Enabling RBAC (Role-Based Access Control)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/defining-users-roles-and-permissions-in-amq-broker.html">Defining Users, Roles, and Permissions in AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-with-openshift-authentication-mechanisms.html">Integrating with OpenShift Authentication Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-external-identity-providers-idp.html">Integrating External Identity Providers (IDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/overview-of-external-idp-integration-eg-ldap-keycloak.html">Overview of External IDP Integration (e.g., LDAP, Keycloak)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-amq-broker-for-external-idp-authentication.html">Configuring AMQ Broker for External Identity Provider (IDP) Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/mapping-external-roles-to-broker-roles.html">Mapping External Roles to Broker Roles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/amq-broker-high-availability-on-openshift.html">AMQ Broker High Availability on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/introduction-to-high-availability-ha-concepts.html">Introduction to High Availability (HA) Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/broker-clustering-strategies-shared-store-vs-replicated-live-backup.html">Broker Clustering Strategies: Shared Store vs. Replicated Live-Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/deploying-and-configuring-an-ha-broker-pair.html">Deploying and Configuring an HA Broker Pair</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/understanding-failover-and-recovery-mechanisms.html">Understanding Failover and Recovery Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/persistence-and-data-replication-for-ha.html">Persistence and Data Replication for HA</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/different-message-stores-for-amq-broker-on-openshift.html">Different Message Stores for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/overview-of-message-store-options.html">Overview of Message Store Options</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/file-based-message-store-configuration.html">File-Based Message Store Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/jdbc-message-store-integration-with-external-databases.html">JDBC Message Store Integration with External Databases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/journal-vs-paging-for-message-persistence.html">Journal vs. Paging for Message Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/choosing-the-appropriate-message-store-strategy.html">Choosing the Appropriate Message Store Strategy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../different-message-stores-for-amq-broker-on-openshift/openshift-storage-considerations-persistent-volumes.html">Storage Considerations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/accessing-management-console-for-amq-broker-on-openshift.html">Accessing Management Console for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/introduction-to-the-hawtio-management-console.html">Introduction to the Hawtio Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/exposing-the-console-via-openshift-routes.html">Exposing the Hawtio Management Console via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/authentication-and-authorization-for-console-access.html">Authentication and Authorization for AMQ Broker Management Console Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/monitoring-broker-metrics-queues-and-topics.html">Monitoring Broker Metrics, Queues, and Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/performing-administrative-tasks-through-the-console.html">Performing Administrative Tasks through the Console</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/enabling-external-access-to-brokers-deployed-on-openshift.html">Enabling External Access to Brokers Deployed on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/openshift-networking-concepts-services-routes-ingress.html">OpenShift Networking Concepts: Services, Routes, Ingress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/exposing-broker-listeners-via-openshift-routes.html">Exposing Broker Listeners via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/configuring-client-connections-for-external-access.html">Configuring Client Connections for External Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/security-implications-and-best-practices-for-external-access.html">Securing External Access to AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core-protocol-client-examples/core-protocol-client-examples.html">Core Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/introduction-to-amq-core-protocol.html">Introduction to AMQ Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/setting-up-a-core-protocol-client-development-environment.html">Setting Up a Core Protocol Client Development Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/developing-producers-and-consumers-with-java-core-protocol.html">Developing Producers and Consumers with Java Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-point-to-point-messaging.html">Implementing Point-to-Point Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-publishsubscribe-messaging.html">Implementing Publish/Subscribe Messaging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amqp-protocol-client-examples/amqp-protocol-client-examples.html">AMQP Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/introduction-to-amqp-10-standard.html">Introduction to AMQP 1.0 Standard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/setting-up-an-amqp-client-development-environment-eg-qpid-jms.html">Setting Up an AMQP Client Development Environment (e.g., Qpid JMS)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/developing-producers-and-consumers-with-amqp-clients-eg-java-python.html">Developing Producers and Consumers with AMQP Clients (e.g., Java, Python)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/connecting-to-amq-broker-using-amqp.html">Connecting to AMQ Broker using AMQP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/exploring-advanced-amqp-features.html">Exploring Advanced AMQP Features</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="hands-on-lab-deploying-and-managing-amq-broker.html">Hands-on Lab: Deploying and Managing AMQ Broker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-deploying-a-basic-amq-broker-instance.html">Lab: Deploying a Basic AMQ Broker Instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-configuring-external-access-and-testing-client-connectivity.html">Lab: Configuring External Access and Testing Client Connectivity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-implementing-basic-security-encryption-rbac.html">Lab: Implementing Basic Security (Encryption, RBAC)</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="lab-deploying-an-ha-broker-cluster.html">Lab: Deploying an HA Broker Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-monitoring-with-the-management-console.html">Lab: Monitoring with the Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lab-developing-and-testing-core-protocol-and-amqp-clients.html">Lab: Developing and Testing Core Protocol and AMQP Clients</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">AMQ Broker on OpenShift: Deployment and Management</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></li>
    <li><a href="hands-on-lab-deploying-and-managing-amq-broker.html">Hands-on Lab: Deploying and Managing AMQ Broker</a></li>
    <li><a href="lab-deploying-an-ha-broker-cluster.html">Lab: Deploying an HA Broker Cluster</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Deploying an HA Broker Cluster</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This lab guides you through deploying a highly available (HA) AMQ Broker cluster on OpenShift Container Platform. You will learn how to configure multiple broker instances and persistent storage to ensure message data integrity and availability, even in the event of pod or node failures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_high_availability_for_amq_broker"><a class="anchor" href="#_overview_of_high_availability_for_amq_broker"></a>Overview of High Availability for AMQ Broker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>High availability (HA) for AMQ Broker on OpenShift is critical for ensuring that your messaging infrastructure remains operational and that message data is never lost, even if individual components fail. The core objective of an HA deployment is to provide continuous service availability and data integrity for your message queues and topics.</p>
</div>
<div class="paragraph">
<p>As described in <a href="#./amq-broker-high-availability-on-openshift.adoc#_introduction_to_high_availability_ha_concepts" class="xref unresolved">Introduction to High Availability (HA) Concepts</a>, AMQ Broker leverages the built-in HA capabilities provided by OpenShift Container Platform to mitigate various types of failures, including pod and node failures.</p>
</div>
<div class="paragraph">
<p>Key mechanisms enabling HA for AMQ Broker on OpenShift include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Pod and Node Failure Mitigation</strong>: OpenShift&#8217;s orchestrator automatically detects failed pods and nodes. It then takes action to restart failed pods or reschedule them to healthy nodes, ensuring that the desired number of broker instances remains operational.</p>
</li>
<li>
<p><strong>Persistent Storage for Data Integrity</strong>: A crucial component of HA is ensuring that message data survives component failures. When persistent storage is enabled for AMQ Broker, each broker pod writes its message data to a dedicated <a href="#./different-message-stores-for-amq-broker-on-openshift.adoc#_openshift_storage_considerations_persistent_volumes" class="xref unresolved">Persistent Volume (PV)</a> which is claimed by a <a href="#./different-message-stores-for-amq-broker-on-openshift.adoc#_openshift_storage_considerations_persistent_volumes" class="xref unresolved">Persistent Volume Claim (PVC)</a>. As highlighted in <a href="#./amq-broker-high-availability-on-openshift.adoc#_overview_of_high_availability_ha" class="xref unresolved">Overview of High Availability (HA)</a>, if a broker pod fails, OpenShift restarts the pod with the same name. This newly restarted pod then re-attaches to its <strong>existing PV</strong>, which still contains all the messaging data, effectively preventing data loss and ensuring data integrity across pod lifecycle events.</p>
</li>
<li>
<p><strong>Broker Clustering Strategies</strong>: While AMQ Broker offers various <a href="#./amq-broker-high-availability-on-openshift.adoc#_broker_clustering_strategies_shared_store_vs_replicated_live_backup" class="xref unresolved">clustering strategies</a> like Shared Store HA and Replicated Live-Backup, deploying multiple broker pods with persistent storage via the Operator forms the basis for a robust HA setup. The AMQ Broker Operator simplifies the deployment of such configurations by managing the underlying OpenShift resources like StatefulSets, which are ideal for stateful applications requiring stable network identities and persistent storage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By deploying an HA broker cluster, you establish a resilient messaging infrastructure capable of maintaining service continuity and data consistency, even under adverse conditions.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_deploying_an_ha_broker_cluster"><a class="anchor" href="#_hands_on_activity_deploying_an_ha_broker_cluster"></a>Hands-on Activity: Deploying an HA Broker Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this activity, you will deploy an AMQ Broker cluster with multiple replicas and persistent storage enabled. This setup forms a basic highly available configuration on OpenShift, managed by the AMQ Broker Operator.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>Before starting this lab, ensure you have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to an OpenShift cluster with administrative privileges.</p>
</li>
<li>
<p>The AMQ Broker Operator installed on your cluster. If you haven&#8217;t installed it yet, please refer to <a href="#./deploying-amq-broker-on-openshift.adoc#_installing_the_amq_broker_operator_via_cli_or_operatorhub" class="xref unresolved">Installing the AMQ Broker Operator via CLI or OperatorHub</a> for detailed instructions.</p>
</li>
<li>
<p>The <code>oc</code> command-line tool configured and logged in to your OpenShift cluster.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_procedure"><a class="anchor" href="#_procedure"></a>Procedure</h3>
<div class="paragraph">
<p>Follow these steps to deploy your HA AMQ Broker cluster:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Log in to OpenShift and Create a Project</strong>
Ensure you are logged in to your OpenShift cluster and create a new project (namespace) dedicated to this lab. This isolates your resources.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash,subs="attributes+"]
----
oc login -u &lt;YOUR_USER&gt; -p &lt;YOUR_PASSWORD&gt; &lt;YOUR_OPENSHIFT_CLUSTER_URL&gt;
oc new-project amq-ha-lab
----
Replace `&lt;YOUR_USER&gt;`, `&lt;YOUR_PASSWORD&gt;`, and `&lt;YOUR_OPENSHIFT_CLUSTER_URL&gt;` with your actual OpenShift credentials and cluster URL.</pre>
</div>
</div>
</li>
<li>
<p><strong>Define the HA Broker Custom Resource (CR)</strong>
Create a YAML file named <code>amq-ha-broker.yaml</code> with the following content. This Custom Resource (CR) defines an AMQ Broker deployment with two replicas and enables persistent storage for message data.</p>
<div class="literalblock">
<div class="content">
<pre>[source,yaml,subs="attributes+"]
----
apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: my-ha-broker
  namespace: amq-ha-lab
spec:
  deploymentPlan:
    size: 2 # Deploy 2 broker pods for HA
    autoCreateResources: true
    persistenceEnabled: true # Enable persistent storage for message data
    persistentVolumeClaim:
      size: 1Gi # Allocate 1 GB for each broker's PVC
  acceptors:
    - name: amqp
      protocols: AMQP
      port: 5672
      sslEnabled: false # For simplicity in this lab; use SSL in production
    - name: core
      protocols: CORE
      port: 61616
      sslEnabled: false # For simplicity in this lab; use SSL in production
  console:
    expose: true # Expose the Hawtio management console
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>*Explanation of the Custom Resource:*
*   `size: 2`: This critical parameter instructs the AMQ Broker Operator to deploy two independent broker pods. The Operator will then manage these pods as a cluster.
*   `persistenceEnabled: true`: This ensures that each broker pod is provisioned with its own xref:./different-message-stores-for-amq-broker-on-openshift.adoc#_openshift_storage_considerations_persistent_volumes[Persistent Volume Claim (PVC)] and corresponding Persistent Volume (PV). This makes message data durable across pod restarts, a cornerstone of HA.
*   `persistentVolumeClaim.size: 1Gi`: Specifies the storage capacity requested for each broker's PVC. Adjust this based on your expected message volume.
*   `acceptors`: Defines the network endpoints (listeners) through which clients can connect to the broker. We've included AMQP and CORE protocols for basic connectivity in this lab. For production environments, refer to xref:./securing-amq-broker-on-openshift.adoc#_encrypting_connections[Securing AMQ Broker on OpenShift] to configure SSL/TLS encryption.
*   `console.expose: true`: Configures the Operator to expose the Hawtio management console via an OpenShift Route, which allows you to monitor and manage your broker. This will be explored further in xref:./accessing-management-console-for-amq-broker-on-openshift.adoc[Accessing Management Console for AMQ Broker on OpenShift].</pre>
</div>
</div>
</li>
<li>
<p><strong>Apply the Custom Resource</strong>
Deploy the broker cluster onto your OpenShift project by applying the <code>amq-ha-broker.yaml</code> file:</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash,subs="attributes+"]
----
oc apply -f amq-ha-broker.yaml
----
The AMQ Broker Operator will now begin creating the necessary OpenShift resources (StatefulSet, Pods, Services, PVCs, Routes) to fulfill the `ActiveMQArtemis` CR.</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify the Deployment</strong>
Monitor the creation and status of the broker pods and associated resources to ensure the HA cluster is successfully deployed.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Check the <code>ActiveMQArtemis</code> instance status:</strong>
[source,bash,subs="attributes+"]
----
oc get activemqartemis my-ha-broker -o yaml
----
Look for <code>status.deploymentStatus.readyState: true</code> and <code>status.deploymentStatus.size: 2</code> in the output, which indicates that both broker instances are ready.</p>
</li>
<li>
<p><strong>Verify broker pods:</strong>
[source,bash,subs="attributes+"]
----
oc get pods -l app=my-ha-broker
----
You should see two pods running, typically named <code>my-ha-broker-ss-0</code> and <code>my-ha-broker-ss-1</code>. The <code>-ss</code> suffix denotes that these pods are part of an OpenShift StatefulSet, which provides stable unique network identifiers and persistent storage for stateful applications like AMQ Broker.</p>
</li>
<li>
<p><strong>Verify Persistent Volume Claims (PVCs):</strong>
[source,bash,subs="attributes+"]
----
oc get pvc -l app=my-ha-broker
----
You should observe two PVCs, one for each broker pod (e.g., <code>data-my-ha-broker-ss-0</code> and <code>data-my-ha-broker-ss-1</code>). These PVCs are crucial for <a href="#./amq-broker-high-availability-on-openshift.adoc#_persistence_and_data_replication_for_ha" class="xref unresolved">persistence and data replication</a>, ensuring that message data is preserved even if a broker pod is deleted or rescheduled.</p>
</li>
<li>
<p><strong>Verify Services and Routes:</strong>
[source,bash,subs="attributes+"]
----
oc get svc,route -l app=my-ha-broker
----
You will see services created for each broker instance (e.g., <code>my-ha-broker-ss-amqp</code>, <code>my-ha-broker-ss-core</code>) and a route for the Hawtio management console.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Simulate a Broker Pod Failure (Optional but Recommended)</strong>
To visually confirm OpenShift&#8217;s HA capabilities and the resilience of your setup, you can intentionally delete one of the broker pods. The StatefulSet controller will automatically detect the missing pod and recreate it, leveraging the existing PVC for data recovery.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Identify a broker pod to delete:</strong>
[source,bash,subs="attributes+"]
----
oc get pods -l app=my-ha-broker
----</p>
</li>
<li>
<p><strong>Delete one of the pods (e.g., <code>my-ha-broker-ss-0</code>):</strong>
[source,bash,subs="attributes+"]
----
oc delete pod my-ha-broker-ss-0
----</p>
</li>
<li>
<p><strong>Observe OpenShift recreating the pod:</strong>
[source,bash,subs="attributes+"]
----
oc get pods -l app=my-ha-broker -w
----
You will observe the old pod terminating (<code>Terminating</code> status) and a new pod (with the <strong>same name</strong>, e.g., <code>my-ha-broker-ss-0</code>) being created and eventually transitioning to <code>Running</code> state. This demonstrates how OpenShift, in conjunction with persistent storage, ensures the continuous availability of your broker instances and their data even during failures.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Connect a Client to the HA Cluster (Conceptual)</strong>
Connecting clients to an HA broker cluster requires careful planning to ensure proper load balancing and failover mechanisms. While a full client implementation is detailed in <a href="#./core-protocol-client-examples.adoc" class="xref unresolved">Core Protocol Client Examples</a> and <a href="#./amqp-protocol-client-examples.adoc" class="xref unresolved">AMQP Protocol Client Examples</a>, it&#8217;s important to understand the high-level considerations for an HA setup.</p>
<div class="literalblock">
<div class="content">
<pre>For external clients, you would typically expose the broker listeners via OpenShift Routes, as covered in xref:./enabling-external-access-to-brokers-deployed-on-openshift.adoc[Enabling External Access to Brokers Deployed on OpenShift]. When aiming for client-side failover across multiple broker instances:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You can configure your client&#8217;s connection URL to include the hostnames or IP addresses of multiple broker endpoints. The client library will then attempt to connect to the first available broker in the list.</p>
</li>
<li>
<p>As noted in the context, if you do not want external clients to rely on the cluster&#8217;s internal load balancing and prefer explicit client-side failover: "In each clientâ€™s connection URL, specify the full host name of the route for each broker pod. The client attempts to connect to the first host name in the connection URL. However, if the first host name is unavailable, the client automatically connects to the next host name in the connection URL, and so on."</p>
</li>
<li>
<p>For Core protocol clients, you might also explicitly set the <code>useTopologyForLoadBalancing=false</code> key in the client&#8217;s connection URL to prevent the client from automatically using the broker&#8217;s cluster topology information for load balancing, giving you more control over failover logic.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This lab has provided a foundational understanding and hands-on experience in deploying an HA AMQ Broker cluster on OpenShift, emphasizing the role of the Operator, persistent storage, and OpenShift&#8217;s inherent resilience features.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="lab-implementing-basic-security-encryption-rbac.html">Lab: Implementing Basic Security (Encryption, RBAC)</a></span>
  <span class="next"><a href="lab-monitoring-with-the-management-console.html">Lab: Monitoring with the Management Console</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
