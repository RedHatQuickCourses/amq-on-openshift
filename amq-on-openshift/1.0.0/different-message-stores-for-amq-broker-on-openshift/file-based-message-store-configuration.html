<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>File-Based Message Store Configuration :: AMQ Broker on OpenShift: Deployment and Management</title>
    <link rel="prev" href="overview-of-message-store-options.html">
    <link rel="next" href="jdbc-message-store-integration-with-external-databases.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">AMQ Broker on OpenShift: Deployment and Management</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="amq-on-openshift" data-version="1.0.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../overview-of-message-oriented-middleware/overview-of-message-oriented-middleware.html">Overview of Message-Oriented Middleware</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/introduction-to-message-oriented-middleware-mom.html">Introduction to Message-Oriented Middleware (MOM)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/benefits-and-use-cases-of-asynchronous-messaging.html">Benefits and Use Cases of Asynchronous Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/core-concepts-producers-consumers-queues-topics.html">Core Concepts: Producers, Consumers, Queues, Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview-of-message-oriented-middleware/common-messaging-patterns-point-to-point-publishsubscribe.html">Common Messaging Patterns</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-overview/amq-broker-overview.html">AMQ Broker Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/introduction-to-red-hat-amq-broker.html">Introduction to Red Hat AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/foundations-in-apache-activemq-artemis.html">Foundations in Apache ActiveMQ Artemis</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/key-features-and-capabilities.html">Key Features and Capabilities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/supported-messaging-protocols-jms-amqp-mqtt-stomp-openwire.html">Supported Messaging Protocols (JMS, AMQP, MQTT, STOMP, OpenWire)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-overview/amq-broker-architecture.html">AMQ Broker Architecture</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/deploying-amq-broker-on-openshift.html">Deploying AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/openshift-container-platform-fundamentals-for-amq-broker.html">OpenShift Container Platform Fundamentals for AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/introduction-to-the-amq-broker-operator.html">Introduction to the AMQ Broker Operator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/installing-the-amq-broker-operator-via-cli-or-operatorhub.html">Installing the AMQ Broker Operator via CLI or OperatorHub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/understanding-amq-broker-custom-resource-definitions-crds.html">understanding-amq-broker-custom-resource-definitions-crds.adoc</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/creating-and-managing-broker-instances-with-custom-resources-crs.html">Creating and Managing Broker Instances with Custom Resources (CRs)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deploying-amq-broker-on-openshift/monitoring-initial-broker-deployment.html">Monitoring Initial Broker Deployment</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-amq-broker-on-openshift.html">Scaling AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/concepts-of-horizontal-and-vertical-scaling.html">Concepts of Horizontal and Vertical Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/scaling-broker-pods-and-replicas.html">Scaling Broker Pods and Replicas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/adjusting-resource-allocations-cpu-memory-for-broker-pods.html">Adjusting Resource Allocations (CPU, Memory) for Broker Pods</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/performance-considerations-for-scaling.html">Performance Considerations for Scaling</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../scaling-amq-broker-on-openshift/best-practices-for-scaling-in-openshift.html">Best Practices for Scaling AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../securing-amq-broker-on-openshift/securing-amq-broker-on-openshift.html">Securing AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/encrypting-connections.html">Encrypting Connections</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-ssltls-for-client-broker-communication.html">Configuring SSL/TLS for Client-Broker Communication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/managing-certificates-and-trust-stores-on-openshift.html">Managing Certificates and Trust Stores on OpenShift</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-secure-listeners.html">Enabling Secure Listeners</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/enabling-rbac-role-based-access-control.html">Enabling RBAC (Role-Based Access Control)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/defining-users-roles-and-permissions-in-amq-broker.html">Defining Users, Roles, and Permissions in AMQ Broker</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-with-openshift-authentication-mechanisms.html">Integrating with OpenShift Authentication Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/integrating-external-identity-providers-idp.html">Integrating External Identity Providers (IDP)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/overview-of-external-idp-integration-eg-ldap-keycloak.html">Overview of External IDP Integration (e.g., LDAP, Keycloak)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/configuring-amq-broker-for-external-idp-authentication.html">Configuring AMQ Broker for External Identity Provider (IDP) Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../securing-amq-broker-on-openshift/mapping-external-roles-to-broker-roles.html">Mapping External Roles to Broker Roles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/amq-broker-high-availability-on-openshift.html">AMQ Broker High Availability on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/introduction-to-high-availability-ha-concepts.html">Introduction to High Availability (HA) Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/broker-clustering-strategies-shared-store-vs-replicated-live-backup.html">Broker Clustering Strategies: Shared Store vs. Replicated Live-Backup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/deploying-and-configuring-an-ha-broker-pair.html">Deploying and Configuring an HA Broker Pair</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/understanding-failover-and-recovery-mechanisms.html">Understanding Failover and Recovery Mechanisms</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amq-broker-high-availability-on-openshift/persistence-and-data-replication-for-ha.html">Persistence and Data Replication for HA</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="different-message-stores-for-amq-broker-on-openshift.html">Different Message Stores for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="overview-of-message-store-options.html">Overview of Message Store Options</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="file-based-message-store-configuration.html">File-Based Message Store Configuration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jdbc-message-store-integration-with-external-databases.html">JDBC Message Store Integration with External Databases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="journal-vs-paging-for-message-persistence.html">Journal vs. Paging for Message Persistence</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="choosing-the-appropriate-message-store-strategy.html">Choosing the Appropriate Message Store Strategy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="openshift-storage-considerations-persistent-volumes.html">Storage Considerations</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/accessing-management-console-for-amq-broker-on-openshift.html">Accessing Management Console for AMQ Broker on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/introduction-to-the-hawtio-management-console.html">Introduction to the Hawtio Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/exposing-the-console-via-openshift-routes.html">Exposing the Hawtio Management Console via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/authentication-and-authorization-for-console-access.html">Authentication and Authorization for AMQ Broker Management Console Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/monitoring-broker-metrics-queues-and-topics.html">Monitoring Broker Metrics, Queues, and Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../accessing-management-console-for-amq-broker-on-openshift/performing-administrative-tasks-through-the-console.html">Performing Administrative Tasks through the Console</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/enabling-external-access-to-brokers-deployed-on-openshift.html">Enabling External Access to Brokers Deployed on OpenShift</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/openshift-networking-concepts-services-routes-ingress.html">OpenShift Networking Concepts: Services, Routes, Ingress</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/exposing-broker-listeners-via-openshift-routes.html">Exposing Broker Listeners via OpenShift Routes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/configuring-client-connections-for-external-access.html">Configuring Client Connections for External Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../enabling-external-access-to-brokers-deployed-on-openshift/security-implications-and-best-practices-for-external-access.html">Securing External Access to AMQ Broker on OpenShift</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../core-protocol-client-examples/core-protocol-client-examples.html">Core Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/introduction-to-amq-core-protocol.html">Introduction to AMQ Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/setting-up-a-core-protocol-client-development-environment.html">Setting Up a Core Protocol Client Development Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/developing-producers-and-consumers-with-java-core-protocol.html">Developing Producers and Consumers with Java Core Protocol</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-point-to-point-messaging.html">Implementing Point-to-Point Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../core-protocol-client-examples/implementing-publishsubscribe-messaging.html">Implementing Publish/Subscribe Messaging</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../amqp-protocol-client-examples/amqp-protocol-client-examples.html">AMQP Protocol Client Examples</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/introduction-to-amqp-10-standard.html">Introduction to AMQP 1.0 Standard</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/setting-up-an-amqp-client-development-environment-eg-qpid-jms.html">Setting Up an AMQP Client Development Environment (e.g., Qpid JMS)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/developing-producers-and-consumers-with-amqp-clients-eg-java-python.html">Developing Producers and Consumers with AMQP Clients (e.g., Java, Python)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/connecting-to-amq-broker-using-amqp.html">Connecting to AMQ Broker using AMQP</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../amqp-protocol-client-examples/exploring-advanced-amqp-features.html">Exploring Advanced AMQP Features</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/hands-on-lab-deploying-and-managing-amq-broker.html">Hands-on Lab: Deploying and Managing AMQ Broker</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-deploying-a-basic-amq-broker-instance.html">Lab: Deploying a Basic AMQ Broker Instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-configuring-external-access-and-testing-client-connectivity.html">Lab: Configuring External Access and Testing Client Connectivity</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-implementing-basic-security-encryption-rbac.html">Lab: Implementing Basic Security (Encryption, RBAC)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-deploying-an-ha-broker-cluster.html">Lab: Deploying an HA Broker Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-monitoring-with-the-management-console.html">Lab: Monitoring with the Management Console</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hands-on-lab-deploying-and-managing-amq-broker/lab-developing-and-testing-core-protocol-and-amqp-clients.html">Lab: Developing and Testing Core Protocol and AMQP Clients</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">AMQ Broker on OpenShift: Deployment and Management</span>
    <span class="version">1.0.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">AMQ Broker on OpenShift: Deployment and Management</a></li>
    <li><a href="different-message-stores-for-amq-broker-on-openshift.html">Different Message Stores for AMQ Broker on OpenShift</a></li>
    <li><a href="file-based-message-store-configuration.html">File-Based Message Store Configuration</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">File-Based Message Store Configuration</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This section delves into configuring Red Hat AMQ Broker to utilize file-based message stores for message persistence, focusing on its implementation within an OpenShift Container Platform environment. File-based message stores are crucial for ensuring message durability and recovering messages after a broker restart or failure.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_understanding_file_based_message_stores"><a class="anchor" href="#_understanding_file_based_message_stores"></a>Understanding File-Based Message Stores</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A file-based message store, as the name suggests, persists all broker-related data directly to the file system. This includes message journals, paging files for large message volumes, binding information, and the large message store itself. This approach is generally simpler to configure compared to JDBC stores and offers excellent performance for many use cases.</p>
</div>
<div class="paragraph">
<p>When deploying AMQ Broker on OpenShift, file-based persistence typically leverages <strong>Persistent Volumes</strong> (PVs) and <strong>Persistent Volume Claims</strong> (PVCs) to ensure that the underlying storage is decoupled from the ephemeral nature of pods. This means your message data can survive pod restarts, rescheduling, or even node failures (depending on the PV&#8217;s underlying storage class).</p>
</div>
<div class="sect2">
<h3 id="_key_directories_for_file_based_persistence"><a class="anchor" href="#_key_directories_for_file_based_persistence"></a>Key Directories for File-Based Persistence</h3>
<div class="paragraph">
<p>AMQ Broker uses several directories to manage its persistent data. These are specified within the <code>brokerProperties</code> attribute of the <code>ActiveMQArtemis</code> Custom Resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>journalDirectory</code>: This is the most critical directory. It stores the <strong>message journal</strong>, which is an append-only log of all messages and transactions. The journal ensures that messages are never lost, even in the event of a sudden broker shutdown.</p>
</li>
<li>
<p><code>pagingDirectory</code>: When a queue accumulates a very large number of messages, or if the broker&#8217;s memory limits are reached, AMQ Broker can <strong>page</strong> messages to disk in this directory. This prevents memory exhaustion and maintains broker stability by offloading messages from RAM.</p>
</li>
<li>
<p><code>bindingsDirectory</code>: This directory stores the <strong>bindings journal</strong>, which contains crucial information about queues, topics, and their corresponding message destinations and subscriptions.</p>
</li>
<li>
<p><code>largeMessagesDirectory</code>: For messages that exceed a configured size threshold (often around 100KB by default), AMQ Broker treats them as <strong>large messages</strong>. These are stored separately in this directory to optimize journal write performance and reduce the in-memory footprint for large payloads.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All these directories are typically configured to point to paths within a mounted <strong>Persistent Volume</strong> when running on OpenShift, ensuring the data&#8217;s persistence across pod lifecycles.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_file_based_stores_on_openshift"><a class="anchor" href="#_configuring_file_based_stores_on_openshift"></a>Configuring File-Based Stores on OpenShift</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On OpenShift, AMQ Broker instances are managed by the AMQ Broker Operator using Custom Resources (CRs). To configure file-based persistence, you define the desired storage within the <code>spec.container.storage</code> and <code>spec.brokerProperties</code> sections of your <code>ActiveMQArtemis</code> CR. The Operator then provisions the necessary PVCs and mounts them to the broker pods.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For a production environment, it is highly recommended to use a robust, network-attached storage solution for your Persistent Volumes (e.g., Ceph RBD, GlusterFS, Azure Disk, AWS EBS) rather than local storage. This ensures data availability and facilitates High Availability (HA) setups.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of how you might define these directories and storage in an <code>ActiveMQArtemis</code> Custom Resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: my-broker-fs
spec:
  deploymentPlan:
    size: 1
    image: registry.redhat.io/amq7/amq-broker-rhel8:7.11
    # Enable persistence for this broker instance
    persistenceEnabled: true
  brokerProperties:
    # Specify the full directory paths on the mounted persistent volume
    # These paths are relative to the root of the mounted volume, which is /var/lib/amq/data by default
    - journalDirectory=/var/lib/amq/data/journal
    - pagingDirectory=/var/lib/amq/data/paging
    - bindingsDirectory=/var/lib/amq/data/bindings
    - largeMessagesDirectory=/var/lib/amq/data/large-messages
  # Define the storage requirements for the broker's persistence
  container:
    storage:
      size: 5Gi # Request a 5Gi persistent volume for the broker data
      # Optional: specify a storage class if you don't want to use the default
      # storageClassName: "ocs-storagecluster-cephfs"</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>spec.deploymentPlan.persistenceEnabled: true</code> explicitly enables persistence for the broker instance.</p>
</li>
<li>
<p><code>spec.container.storage.size</code> requests a Persistent Volume Claim (PVC) of 5Gi. The AMQ Broker Operator will automatically create this PVC if one with the specified size and access mode doesn&#8217;t already exist and bind it to the broker pod. The Operator mounts this PVC at <code>/var/lib/amq/data</code> within the broker container.</p>
</li>
<li>
<p>The <code>brokerProperties</code> define the <strong>paths</strong> within the mounted volume (<code>/var/lib/amq/data</code>) where AMQ Broker will store its data. The Operator ensures these subdirectories are created and managed correctly.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_openshift_storage_considerations_persistent_volumes"><a class="anchor" href="#_openshift_storage_considerations_persistent_volumes"></a>OpenShift Storage Considerations (Persistent Volumes)</h3>
<div class="paragraph">
<p>When the <code>storage</code> field is specified in the <code>ActiveMQArtemis</code> CR, the Operator automatically creates a <code>PersistentVolumeClaim</code> (PVC) for each broker instance if it doesn&#8217;t already exist. This PVC then binds to an available <code>PersistentVolume</code> (PV) that provides the actual storage.</p>
</div>
<div class="paragraph">
<p>Key considerations for OpenShift storage when configuring file-based message stores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Storage Class</strong>: It&#8217;s crucial to have a <code>StorageClass</code> defined in your OpenShift cluster. The Operator will use the default <code>StorageClass</code> or one specified in your CR (e.g., <code>storageClassName: "your-storage-class-name"</code>).</p>
</li>
<li>
<p><strong>Access Modes</strong>: For single-instance brokers, <code>ReadWriteOnce</code> (RWO) is typically sufficient. For Shared Store High Availability setups, <code>ReadWriteMany</code> (RWX) is required, which fewer storage providers support natively. Ensure your chosen <code>StorageClass</code> supports the necessary access mode.</p>
</li>
<li>
<p><strong>Capacity</strong>: Ensure the requested <code>size</code> in the CR is adequate for your expected message volume, message retention policies, and overhead for the various journals and paging files. Underestimating capacity can lead to broker instability or message loss.</p>
</li>
<li>
<p><strong>Performance</strong>: The performance of your message store is directly tied to the underlying storage solution. High-throughput, low-latency storage is critical for production AMQ Broker deployments to ensure efficient message processing.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hands_on_activity_deploying_an_amq_broker_with_file_based_persistence"><a class="anchor" href="#_hands_on_activity_deploying_an_amq_broker_with_file_based_persistence"></a>Hands-on Activity: Deploying an AMQ Broker with File-Based Persistence</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, you will deploy a basic AMQ Broker instance on OpenShift, explicitly configuring its file-based message store using a Persistent Volume Claim.</p>
</div>
<div class="sect2">
<h3 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h3>
<div class="ulist">
<ul>
<li>
<p>An OpenShift cluster with <code>oc</code> CLI configured and logged in.</p>
</li>
<li>
<p>The AMQ Broker Operator installed in your OpenShift project.</p>
</li>
<li>
<p>A <code>StorageClass</code> available in your OpenShift cluster (e.g., <code>ocs-storagecluster-cephfs</code>, <code>standard</code>, <code>gp2</code>). You can check available storage classes with <code>oc get sc</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Log in to your OpenShift Cluster</strong>
Ensure you are logged in to the correct OpenShift cluster and project.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc login -u developer -p developer https://your-openshift-api-url:6443
oc project my-amq-project # Replace with your project name where the Operator is installed
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Create a Custom Resource for AMQ Broker with File-Based Persistence</strong>
Create a file named <code>broker-file-store.yaml</code> with the following content. This configuration deploys a single broker instance and requests a 2Gi Persistent Volume for its message store.</p>
<div class="literalblock">
<div class="content">
<pre>[source,yaml]
----
apiVersion: broker.amq.io/v1beta1
kind: ActiveMQArtemis
metadata:
  name: my-file-broker
spec:
  deploymentPlan:
    size: 1
    image: registry.redhat.io/amq7/amq-broker-rhel8:7.11
    # Crucial: Enable persistence using the storage configuration below
    persistenceEnabled: true
  brokerProperties:
    # Define the directory paths for persistence within the mounted volume
    - journalDirectory=/var/lib/amq/data/journal
    - pagingDirectory=/var/lib/amq/data/paging
    - bindingsDirectory=/var/lib/amq/data/bindings
    - largeMessagesDirectory=/var/lib/amq/data/large-messages
  container:
    storage:
      size: 2Gi # Request a 2Gi Persistent Volume Claim
      # Optional: Uncomment and specify a storage class if your cluster has multiple
      # and you don't want to use the default one.
      # storageClassName: "your-preferred-storage-class"
----</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>[IMPORTANT]
====
The `persistenceEnabled: true` flag explicitly tells the Operator to manage persistent storage for the broker instance. While setting `container.storage.size` implicitly implies persistence, this flag makes the intent clear and is considered a best practice.
====</pre>
</div>
</div>
</li>
<li>
<p><strong>Apply the Custom Resource</strong>
Deploy the broker instance by applying the YAML file:</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc apply -f broker-file-store.yaml
----</pre>
</div>
</div>
</li>
<li>
<p><strong>Verify the Deployment and PVC</strong>
Monitor the pod creation and verify that a PVC has been created and bound successfully.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Check the broker pod status:
[source,bash]
----
oc get pods -l app=my-file-broker
----
Wait until the pod shows <code>Running</code> and <code>READY 1/1</code>.</p>
</li>
<li>
<p>Verify the Persistent Volume Claim:
[source,bash]
----
oc get pvc -l app=my-file-broker
----
You should see a PVC named <code>my-file-broker-pvc-0</code> (or similar, depending on the operator&#8217;s naming convention) with status <code>Bound</code>.</p>
</li>
<li>
<p>Inspect the mounted volume inside the pod to confirm the PVC is being used:
[source,bash]
----
oc exec -it $(oc get pod -l app=my-file-broker -o jsonpath='{.items[0].metadata.name}')&#8201;&#8212;&#8201;df -h /var/lib/amq/data
----
This command will show the mounted file system at <code>/var/lib/amq/data</code> and its usage, confirming the PV is correctly mounted within the broker pod.</p>
</li>
<li>
<p>List the created persistence directories within the mounted volume:
[source,bash]
----
oc exec -it $(oc get pod -l app=my-file-broker -o jsonpath='{.items[0].metadata.name}')&#8201;&#8212;&#8201;ls -l /var/lib/amq/data
----
You should observe the <code>journal</code>, <code>paging</code>, <code>bindings</code>, and <code>large-messages</code> directories, confirming the broker is set up for file-based persistence.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>Clean Up (Optional)</strong>
When you are finished with the lab, delete the broker instance and its associated PVC.</p>
<div class="literalblock">
<div class="content">
<pre>[source,bash]
----
oc delete -f broker-file-store.yaml
# The Operator typically deletes the PVC when the CR is deleted.
# However, if the PVC persists due to specific reclaim policies, you might need:
# oc delete pvc -l app=my-file-broker
----
[NOTE]
====
By default, the Operator will delete the PVC when the `ActiveMQArtemis` CR is deleted. However, in some cases, especially if the `reclaimPolicy` on the underlying Persistent Volume (PV) is set to `Retain`, the PV might need to be manually cleaned up by a cluster administrator.
====</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This hands-on activity demonstrates how to successfully deploy an AMQ Broker instance with file-based persistence, leveraging OpenShift&#8217;s storage capabilities to ensure message durability.</p>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="overview-of-message-store-options.html">Overview of Message Store Options</a></span>
  <span class="next"><a href="jdbc-message-store-integration-with-external-databases.html">JDBC Message Store Integration with External Databases</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
